## 第4章：计算核心设计

在上一章中，我们从系统层面了解了NPU的整体架构。现在，让我们深入到NPU的心脏——计算核心。如果说NPU是一座高效运转的工厂，那么计算核心就是工厂里的生产线，而MAC（Multiply-Accumulate）单元则是生产线上的工人。本章将详细探讨如何设计高效的计算核心，从基础的MAC单元开始，逐步构建起能够处理海量神经网络运算的脉动阵列。

我们将重点关注三个关键问题：**如何设计单个MAC单元以实现最高效率？如何将成千上万个MAC单元组织成阵列？如何通过不同的数据流模式（Weight Stationary、Output Stationary、Row Stationary）来优化不同场景下的计算效率？**通过回答这些问题，你将掌握NPU计算核心设计的精髓。

### 4.1 MAC阵列设计

#### 4.1.1 基础MAC单元

MAC (Multiply-Accumulate) 是NPU的基本计算单元，执行 `C = C + A × B` 运算。

计算核心的演进历程是一部从标量到张量的进化史。就像生物从单细胞进化到多细胞生物，计算单元也经历了类似的演变：

  **计算架构的演进历程**
- **标量处理器时代（1980s-1990s）：**：一次处理一个数据，就像用筷子一粒一粒地夹米饭。- **SIMD时代（2000s）：** 引入向量处理，一条指令处理多个数据，就像用勺子一次舀起多粒米饭。代表作：Intel SSE/AVX。
- **GPU时代（2010s）：**：大规模并行处理，成千上万个核心同时工作，像一个巨大的自助餐厅，数百个人同时进餐。- **NPU/TPU时代（2015s-）：** 专为矩阵运算优化，引入脉动阵列和张量核心，就像高度自动化的寿司传送带，每个工位专注完成特定任务。
- **未来：模拟计算与存内计算（2025+）：**：打破冯·诺依曼架构，计算与存储融合，像大脑神经元般工作。
